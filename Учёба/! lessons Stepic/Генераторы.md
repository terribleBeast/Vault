---
tags:
  - Python
---

---
Дата создания: 2024-12-01 13:12
Дата последнего изменения: 2024-12-01 13:12
---
## Основные идеи
1) 
---
### Функции генераторы
**Функция генератор** - это функция, которая возвращает итератор. Она выглядит как обычная функция, но с использованием выражения `yield`.

При каждом вызове функция генератор сохраняет локальные переменные от вызова к вызову. Это своего рода возобновляемая функция.

Генератор – это итератор, который порождает значения, переданные `yield`. Когда выполнение доходит до конца функции, объект генератор возбуждает исключение `StopIteration` в полном соответствии с протоколом итератора.
### Принцип работы
``` python
def generate_AB(): 
    print('start') 
    yield 'A' 
    print('continue') 
    yield 'B' 
    print('end') 
    
    
for char in generate_AB(): 
    print('-->', char)

# start 
# --> A 
# continue 
# --> B 
# end
```

Цикл `for` преобразует выражение в итератор. В теле цикла на каждой итерации печатается `-->` и значение, полученное при вызове `next(iterator)`

Во время первой итерации и первом вызове `next(iterator)` генератор, перед тем как сгенерировать значение `'A'` (то есть дойти до строки `yield 'A'`), сначала выполняет строку `print('start')`.

Во время второй итерации и втором вызове `next(iterator)` генератор, перед тем как сгенерировать значение `'B'` (то есть дойти до строки `yield 'B'`), сначала выполняет строку `print('continue')`.

Во время третьей итерации и третьем вызове `next(iterator)` генератор выполняет строку `print('end')` и завершает свою работу, возбуждая исключение `StopIteration`. Цикл `for` перехватывает это исключение и нормально завершается.

## `return`

До версии Python 3.3 наличие ключевого слова `return` внутри функции генератора приводило к возникновению ошибки:  `Syntaxerror`.

Теперь, когда выполнение генератора доходит до `return`, то это приводит к возбуждению исключения `StopIteration`.

## Особенности и ограничения функций генераторов

Основные особенности, присущие всем функциям генераторам:

- любая функция, содержащая ключевое слово `yield`, является функцией генератором
- когда вызывается функция генератор, то она **не возвращает единственное значение**, как это делает обыкновенная функция
- функция генератор всегда возвращает объект типа `generator`, который поддерживает протокол итератора

Разница между `yield` и оператором `return` заключается в том, что для ключевого слова `yield` состояние выполнения генератора приостанавливается и локальные переменные сохраняются. При следующем вызове метода генератора `__next__()` функция возобновляет свое выполнение из той точки, из которой завершила в прошлый раз.

Генератор является итератором, поэтому он обладает всеми его особенностями:

- нельзя получить длину генератора функцией `len()`
- нельзя распечатать элементы генератора функцией `print()` без предварительной распаковки
- у генератора нельзя получить элемент по индексу
- после итерации по генератору он становится пустым


### Примеры

``` python
# последовательность числе от low до high включительно
def counter(low, high): 
    for num in range(low, high + 1): 
        yield num
```


## Конвейеры генераторов

Конвейеры генераторов - последовательность генераторов, которые применяются к данным.

``` python
n = 10 

integers = (i for i in range(1, n + 1)) 
evens = (i for i in integers if not i % 2) 
squared = (i * i for i in evens) 
negated = (-i for i in squared) 

print(*negated)
```

> [!NOTE] Особенность
> Генераторы применяются последовательно к элементам. (полезно при работе с большими файлами)

``` python
with open('data.csv', 'r', encoding='utf-8') as file: 
	file_lines = (line for line in file) 
	line_values = (line.rstrip().split(',') for line in file_lines) 
	
	file_headers = next(line_values) 
	line_dicts = (dict(zip(file_headers, data)) for data in line_values) 
	
	result = ( (line['user_name'], line['user_ip']) for line in line_dicts if 'stepik.org' in line['page_url'] )
```

Генераторы работают чуть медленнее, чем `return`, но значительно выигрывают в потреблении памяти.

``` python
def read_immediately(file_name): 
	with open(file_name, 'r', encoding='utf-8') as file: 
		result = [] 
		for line in file: 
			line = line.rstrip('\n') 
			if line != '': 
				result.append(line) 
		
		return result 

def read_lazy(file_name): 
	
	with open(file_name, 'r', encoding='utf-8') as file: 
		for line in file: 
			line = line.rstrip('\n') 
			if line != '': 
				yield line
```
![](compare_return_yield.png)



## Методы генератора

https://docs-python.ru/tutorial/generatory-python/ispolzovanie-send-throw-close/

## Сравнение итераторов и объектов `range`

### Итераторы
 Итераторы — это ленивые, одноразовые итерируемые объекты. Они ленивые, потому что у них есть возможность вычислять элементы только по мере того, как мы их перебираем. Они одноразовые, потому что как только мы использовали элемент из итератора, он исчезает навсегда.

### Объект `range`
`range` не является итератором

``` python
range_obj = range(1, 3)

print(next(range_obj)) # TypeError: 'range' object is not an iterator
```
Поэтому по одному `range` объекту можно итерировать неоднократно.


> [!NOTE] Примечание
> `range` ленив, так как вычисляет следующие элементы на лету.

Вывод: `range` объекты — это ленивые последовательности. Это последовательности (подобно спискам, кортежам и строкам), но не хранящие в памяти все свои элементы.

#### Работа `in` в `range`
Когда мы используем `in`, то Python находится ли этот элемент внутри `start` - `stop`. Если да, то проверяет кратно ли оно шагу

# Примечания

1) Функция генератор и генераторная функция - это одно и то же.
2) Генератор - это итерируемый объект.
3) Итерируемый объект и итератор – это протоколы, то есть правила реализации. Генератор – это не протокол, а конкретная реализация. Это специальный механизм в языке Python, который позволяет создать однократно перебираемую функцию, логика перебора которой легко и красиво описывается.
4) Единственное синтаксическое различие между обычной функцией и функцией генератором – тот факт, что в теле последней встречается ключевое слово `yield`. Многие разработчики из команды Python считали, что для функций генераторов следовало бы ввести новое ключевое слово `gen` вместо `def`, но Гвидо не отказался.
5) За кулисами генераторной функции создается итератор.
6) 


---
## Ресурсы:
1) [Поколение 1](https://stepik.org/lesson/640048/step/1?unit=636568)
2) [Док к функциям?](https://docs.python.org/3/reference/expressions.html#generator-iterator-methods)
3) [Конвейеры генераторов (поколение)](https://stepik.org/lesson/673155/step/1?unit=671418)
4) [Генератор словарей](https://stepik.org/lesson/673155/step/1?discussion=8834480&unit=671418)
5) [Особенности итераторов](https://stepik.org/lesson/673155/step/12?unit=671418)


